



<div class="page-banner-area dotted-bg bg-fbecd7">
  <div class="container">
    <div class="page-banner-content">
      <h1>{{ currentLang.pageTitle }}</h1>
      <ul class="meta">
        <li><a routerLink="/">{{ currentLang.home }}</a></li>
        <li>{{ currentLang.pageTitle }}</li>
      </ul>
    </div>
  </div>
</div>

<div class="projects-area ptb-100 dotted-bg">
  <div *ngIf="!isLoggedIn" class="alert alert-warning text-center">
    ‚ö†Ô∏è Veuillez <a routerLink="/auth">vous connecter</a> ou 
    <a routerLink="/auth">vous inscrire</a> pour acc√©der aux projets.
  </div>
  <div *ngIf="isLoggedIn">
  <div class="container">
    <div class="row justify-content-center">

    

      <div class="col-lg-4 col-md-6" *ngFor="let p of pagedProjets">
        <div class="single-project-card card p-3 shadow-sm">
          <a routerLink="/projet-details" class="image d-block mb-2">
            <img [src]="getImageSrc(p.image)" [alt]="p.title" class="img-fluid" />
          </a>
      
          <div class="content">
            <h4 class="mb-1">
              <a routerLink="/projet-details">{{ p.title || currentLang.defaultTitle }}</a>
            </h4>
      
            <div class="meta d-flex align-items-center mb-2">
              <div class="date me-2 small text-muted">{{ p.day }} <span>{{ p.month }}</span></div>
            </div>
      
           
            <p class="excerpt">
              {{ getDisplayedDescription(p) }}
            </p>
            <a class="link-btn small" (click)="toggleDescription(p)">
              {{ p.showFull ? currentLang.seeLess : currentLang.seeMore }}
            </a>
            <div class="d-flex justify-content-between align-items-center mt-3 mb-2">
              <a class="download btn btn-sm btn-outline-primary" (click)="download(p)">{{currentLang.download}} ‚Üó</a>
      
              <div class="d-flex align-items-center">
                <button class="btn btn-sm like-btn me-2" (click)="toggleLike(p.id)">
                  <span [class.liked]="p.liked" aria-hidden="true">{{ p.liked ? '‚ù§Ô∏è' : 'ü§ç' }}</span>
                </button>
                <span class="small">{{ p.likeCount || 0 }}</span>
              </div>
            </div>
      
            <div class="comments-preview mt-2">
              <div *ngIf="comments[p.id]?.length; else noComments">
                <div *ngFor="let c of (p.showAllComments ? comments[p.id] : comments[p.id] | slice:0:2)" class="comment d-flex align-items-start mb-1">
                  <div class="comment-author me-2"><strong>{{ c.utilisateur?.username || c.utilisateur?.email }}</strong></div>
                  <div class="comment-body small">{{ c.contenu }}</div>
                </div>
            
                <button *ngIf="comments[p.id].length > 2" class="btn btn-link btn-sm p-0" (click)="p.showAllComments = !p.showAllComments">
                  {{ p.showAllComments ? currentLang.seeLessComments : currentLang.seeMoreComments }} ({{ comments[p.id].length }})
                </button>
              </div>
            
              <ng-template #noComments>
                <div class="small text-muted">{{ currentLang.noComments }}</div>
              </ng-template>
            </div>
          
      <div *ngIf="authService.isLoggedIn()" class="add-comment mt-3">
        <textarea
          [(ngModel)]="newComment[p.id]"
          class="form-control form-control-sm mb-2"
          rows="2"
          [placeholder]="currentLang.writeComment"></textarea>
        <div class="d-flex justify-content-end">
          <button class="btn btn-sm btn-primary" [disabled]="!newComment[p.id]?.trim()" (click)="addComment(p.id)">
            {{ currentLang.send }}
          </button>
        </div>
      </div>
      
      <div *ngIf="!authService.isLoggedIn()" class="login-message mt-2">
        <p class="small">
          <a routerLink="/login">{{ currentLang.loginToAct }}</a>
        </p>
      </div>


      <nav class="pagination-area" *ngIf="totalPages > 1">
        <ul class="pagination">
          <li class="page-item" [class.disabled]="currentPage === 1">
            <a class="page-link" (click)="prevPage()">
              <i class="flaticon-chevron-1"></i>
            </a>
          </li>
      
          <li class="page-item" *ngFor="let p of pages" [class.active]="p === currentPage">
            <a class="page-link" (click)="goToPage(p)">{{ p }}</a>
          </li>
      
          <li class="page-item" [class.disabled]="currentPage === totalPages">
            <a class="page-link" (click)="nextPage()">
              <i class="flaticon-chevron"></i>
            </a>
          </li>
        </ul>
      </nav>
      
    </div>
    </div>
  </div>
</div>
   